<!doctype html>
<html>
  <head>
    <title>My first VR site</title>
		<script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
		<link rel="manifest" href="/manifest.json">  <!-- Add to home screen for Safari on iOS -->
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-title" content="Weather PWA">
		<link rel="apple-touch-icon" href="images/icons/icon-152x152.png">a
  </head>
  <body>
    <a-scene>
			<a-sky id="skybox"></a-sky>
			<a-camera id="target" position="0 1.4 0">
				    <a-entity cursor="fuse: true; fuseTimeout: 3000" 
											position="0 0 -1" 
											geometry="primitive: ring" 
											scale="0.03 0.03 0.03" 
											material="color: white; shader: flat">
							<a-animation begin="cursor-fusing" easing="ease-in" attribute="scale" 
													 fill="none" from="0.03 0.03 0.03" to="0.001 0.001 0.001"></a-animation>
						</a-entity>
       </a-camera>
		</a-scene>

		<script type="text/javascript">
			var room = 'all';
			var match = location.search.match(/room=(.*?)(&|$)/);
			if(match) {
			    room = decodeURIComponent(match[1]);
			}
			
      var scenes = [
					{'scene_id':0,'spheres':[{'rad':0.725, 'next_id':'001'},{'rad':0.89, 'next_id':'002'}],'img_name':'img/000.JPG'}, // Shosai 0
					{'scene_id':1,'spheres':[{'rad':0.725, 'next_id':'000'},{'rad':0.89, 'next_id':'002'}],'img_name':'img/001.JPG'}, // Shosai open 1
					{'scene_id':2,'spheres':[{'rad':0.32, 'next_id':'005'},{'rad':0.51, 'next_id':'000'},{'rad':0.71, 'next_id':'003'},{'rad':0.77, 'next_id':'007'},{'rad':0.83, 'next_id':'015'},],'img_name':'img/002.JPG'}, // Living Room 2
					{'scene_id':3,'spheres':[{'rad':0.5, 'next_id':'002'},{'rad':0.68, 'next_id':'004'}],'img_name':'img/003.JPG'}, // Child room 3
					{'scene_id':4,'spheres':[{'rad':0.5, 'next_id':'002'},{'rad':0.68, 'next_id':'003'}],'img_name':'img/004.JPG'}, // Child room open 4
					{'scene_id':5,'spheres':[{'rad':0.22, 'next_id':'006'},{'rad':0.52, 'next_id':'002'}],'img_name':'img/005.JPG'}, // Terrace 5
					{'scene_id':6,'spheres':[{'rad':0.512, 'next_id':'005'}],'img_name':'img/006.JPG'}, // Terrace 2 6
					{'scene_id':7,'spheres':[{'rad':0.3, 'next_id':'002'},{'rad':0.73, 'next_id':'009'}],'img_name':'img/007.JPG'}, // Entrance 7
					{'scene_id':8,'spheres':[{'rad':0.725, 'next_id':'009'}],'img_name':'img/008.JPG'}, // Toilet 8
					{'scene_id':9,'spheres':[{'rad':0.195, 'next_id':'013'},{'rad':0.243, 'next_id':'011'},{'rad':0.47, 'next_id':'010'},{'rad':0.775, 'next_id':'008'},{'rad':0.87, 'next_id':'002'},],'img_name':'img/009.JPG'}, // Corridor 9
					{'scene_id':10,'spheres':[{'rad':0.195, 'next_id':'013'},{'rad':0.243, 'next_id':'011'},{'rad':0.47, 'next_id':'009'},{'rad':0.775, 'next_id':'008'},{'rad':0.87, 'next_id':'002'},],'img_name':'img/010.JPG'}, // Corridor Open 10									
					{'scene_id':11,'spheres':[{'rad':0.1, 'next_id':'012'},{'rad':0.32, 'next_id':'009'}],'img_name':'img/011.JPG'}, // Washroom 11
					{'scene_id':12,'spheres':[{'rad':0.1, 'next_id':'011'}],'img_name':'img/012.JPG'}, // Bathroom 12
					{'scene_id':13,'spheres':[{'rad':0.08, 'next_id':'009'},{'rad':0.89, 'next_id':'014'}],'img_name':'img/013.JPG'}, // Bedroom 13
					{'scene_id':14,'spheres':[{'rad':0.11, 'next_id':'013'}],'img_name':'img/014.JPG'}, // Walk in closet 14
					{'scene_id':15,'spheres':[{'rad':0.71, 'next_id':'002'}],'img_name':'img/015.JPG'}, // Kitchen 15
					{'scene_id':100,'spheres':[{'rad':0.75, 'next_id':'000'},{'rad':0.92, 'next_id':'002'}],'img_name':'img/100.JPG'},
			];

      createScene (scenes[Number(room)]);
      createWarpSphere ('#00ff00');
　　　　
      (function () {
					var scene = document.querySelector('a-scene');
					if (scene.hasLoaded) {
							scene.enterVR();
					} else {
							scene.addEventListener('loaded', function () {
									setTimeout(function () {
											scene.enterVR();
									}, 10);
							});
					};
			})();

      if ('serviceWorker' in navigator) {
					navigator.serviceWorker
							.register('./sw.js')
							.then(function() { console.log('Service Worker Registered'); });
			}

      function createScene (scene) {
		      // Change skybox
					var skyBox = document.getElementById('skybox');
					skyBox.setAttribute ('src',scene['img_name']);

					// Add Spheres
					var spheres = scene['spheres'];
					for (var i=0; i < spheres.length; i++) {
							createSphere(spheres[i]['rad'], spheres[i]['next_id']);
					}
			}	
      function createSphere (rad, next_id) {
					rad = ((rad -0.75) * 2 + 3/2) * Math.PI;
					
					var scene = document.querySelector('a-scene');
					var sphere = document.createElement('a-sphere');
					var position_str = String(Math.cos(rad)*7) + ' 3 ' + String(Math.sin(rad)*5);

					sphere.setAttribute('color', '#666666');
					sphere.setAttribute('radius', '0.5');
					sphere.setAttribute('next_id', next_id);
					sphere.setAttribute('class', 'open_sphere');
					sphere.setAttribute('position', position_str);
					sphere.setAttribute('onclick','location.href=\'?room='+String(next_id)+'\';');

					scene.appendChild(sphere);
			}
      function createWarpSphere (color) {
					var scene = document.querySelector('a-scene');
					var sphere = document.createElement('a-sphere');
					
					sphere.setAttribute('color', color);
					sphere.setAttribute('radius', '0.5');
					sphere.setAttribute('position', '0 0 0');
					sphere.setAttribute('onclick','toggleSphere();');
					
					scene.appendChild(sphere);
			}
      function toggleSphere () {
					var spheres = document.querySelectorAll('a-sphere');
					for (var i=0; i < spheres.length; i++) {
							if (spheres[i].getAttribute('visible') == true) {
									spheres[i].setAttribute('visible',false);
							} else {
									spheres[i].setAttribute('visible',true);
							}
					}
  				createWarpSphere('#00ff00');
			}
		</script>
  </body>
</html>
